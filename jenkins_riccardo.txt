pipeline {
    agent any
    /*
    tools {
        maven 'Maven 3.8.1'
    }
    */
    stages {
        stage('Inizio Pipeline') {
            steps {
                echo "Inizio della pipeline - Build n. ${env.BUILD_NUMBER}"
            }
        }
        stage('Checkout da GIT'){
            steps {
            git branch: 'main', url: 'https://github.com/andrea-colleoni/academy-devops-2021-git.git'
            sh 'ls -lrt'
        }
    }
    stage('Maven compile'){
        steps {
            // sh 'mvn compile -f primi-tests/pom.xml'
            withMaven(maven: 'Maven 3.8.1') {
            sh 'mvn compile -f primi-tests/pom.xml'
}
        }
    }
    stage('Maven test'){
        steps {
            withMaven(maven: 'Maven 3.8.1') {
            sh 'mvn test -f primi-tests/pom.xml -Dwebdriver.gecko.driver=/Users/riccardo/Desktop/geckodriver/geckodriver'
        }
        }
    }
    
}
post {
  success {
    junit 'primi-tests/target/surefire-reports/*.xml'
  }
  failure {
    emailext (
        body: 'La build numero ${env.JOB_NAME} Ã¨ fallita', 
        subject: 'Pipeline ${env.JOB_NAME} fallito', 
        to: 'riccardo@ciao.info'
        )
  }
}

}
